#!/bin/bash

#PBS -N hu_convert
#PBS -l ncpus=16
#PBS -l mem=128GB
#PBS -l walltime=23:00:00
#PBS -l jobfs=100GB
#PBS -q expresssr
#PBS -l wd
#PBS -P eu59
#PBS -l storage=gdata/eu59+gdata/dk92

module use /g/data/dk92/apps/Modules/modulefiles
module load NCI-ai-ml/24.11

python3 /g/data/eu59/FlowMOP/data/code/process_fcs_files.py \
    --base-dir /g/data/eu59/FlowMOP/data/hu_dataset/fcs_files/extracted/ \
    --metadata /g/data/eu59/FlowMOP/data/hu_dataset/fcs_files/process_metadata/combined_metadata.parquet \
    --output-dir /g/data/eu59/FlowMOP/data/hu_dataset/fcs_files/parquet \
    --output-name hu_parquet \
    --filename-column file_path \
    --workers 16 \
    --memory-limit 128GB \
    --chunk-size 100000 \
    --processor-type fcs